
DROP TABLE CONFERENZE;
DROP TABLE ARTICOLI;
DROP TABLE AUTORI;

CREATE TABLE CONFERENZE (

	NOMECONF VARCHAR(15) NOT NULL,
	ANNO INT NOT NULL,
	LUOGO VARCHAR(15) NOT NULL,
	
	PRIMARY KEY(NOMECONF, ANNO)
	
);

CREATE TABLE ARTICOLI(

	ARTID CHAR(5) NOT NULL PRIMARY KEY,
	TITOLO VARCHAR(15) NOT NULL,
	NOMECONF VARCHAR(15) NOT NULL,
	ANNO INT NOT NULL,
	
	FOREIGN KEY(NOMECONF, ANNO)
		REFERENCES CONFERENZE
	
);

CREATE TABLE AUTORI(

	ARTID CHAR(5) NOT NULL,
	NOME VARCHAR(15) NOT NULL,
	
	PRIMARY KEY(ARTID, NOME)
	
);

-- CONFERENZE(NomeConf,Anno,Luogo);

-- ARTICOLI(ArtID,Titolo,NomeConf,Anno),
-- NomeConf,Anno REFERENCES CONFERENZE;

-- AUTORI(ArtID,Nome),
-- ArtID REFERENCES ARTICOLI;

-- 2.1) [2 p.] Gli autori che tutti gli anni hanno pubblicato almeno un articolo nella conferenza
-- 'SEBD'

--SENZA DIVISIONE!
WITH ART_AUT_SEBD(ARTID, NOME, NOMECONF, ANNO) AS(

	SELECT AR.ARTID, AU.NOME, AR.NOMECONF, AR.ANNO
	FROM ARTICOLI AR JOIN AUTORI AU ON (AR.ARTID = AU.ARTID)
	WHERE UPPER(AR.NOMECONF) = 'SEBD'

)

SELECT NOME
FROM ART_AUT_SEBD
GROUP BY NOME
HAVING (COUNT(DISTINCT ANNO)) = (SELECT COUNT(DISTINCT ANNO)
							     FROM ART_AUT_SEBD);

--COND DIVISIONE --> SIMIL-ALGEBRA!

--2.2) [3 p.] Per ogni conferenza italiana, l'autore che ha pubblicato nel maggior numero di anni

WITH CONF_AUT_NUMANNIPUBBL(CONF, AUT, NUM_ANNI_PUBBL) AS(

	SELECT C.NOMECONF, AU.NOME, COUNT(DISTINCT AR.ANNO)
	FROM CONFERENZE C, ARTICOLI AR, AUTORI AU
	WHERE C.NOMECONF = AR.NOMECONF
	AND C.ANNO = AR.ANNO
	AND AR.ARTID = AU.ARTID
	AND UPPER(C.LUOGO) = 'ITALIA'
	GROUP BY C.NOMECONF, AU.NOME

)

SELECT C.*
FROM  CONF_AUT_NUMANNIPUBBL C
WHERE C.NUM_ANNI_PUBBL = (SELECT MAX(C1.NUM_ANNI_PUBBL)
						  FROM CONF_AUT_NUMANNIPUBBL C1
						  WHERE C1.CONF = C.CONF);
















