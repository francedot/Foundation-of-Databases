
SELECT NAME
FROM SYSIBM.SYSTRIGGERS
WHERE SCHEMA = '09050944';

-- e) una tupla di E2 non ha nessun valore di B uguale a 10;

CREATE TRIGGER PUNTOE
NO CASCADE BEFORE INSERT ON E1
REFERENCING NEW AS N
FOR EACH ROW
WHEN (N.TIPO = 2 AND EXISTS(SELECT *
							FROM BE1
							WHERE BE1.K1B = N.K1
							AND B = 10))
SIGNAL SQLSTATE '70001' ('La tupla di E2 ha un valore di B = 10 o meglio K1 in E1 viene referenziata da K1B con un valore di B pari a 10!');


-- SEMPRE IL SOLITO PROBLEMA!!! QUANDO INSERISCO UNA TUPLA IN E1 NON ESISTE
-- ALCUN RIFERIMENTO DA BE1(FKEY: K1B) QUINDI NON ACCHIAPPO ALCUNA TUPLA CON
-- B = 10! INVECE SE INSERISCO IN B UNA TUPLA = 10 VADO SUBITO A VEDERE SE LA
-- CHIAVE REFERENZIATA HA TIPO = 2 (E QUINDI SI TRATTA DI UN ISTANZA DI E2)
-- LANCIANDO L' ECCEZIONE SE ESISTE ALMENO UNA TUPLA!
-- N.B LA FRECCIA VA SEMPRE DA F.KEY A CHIAVE REFERENZIATA E DUNQUE SI PARTE
-- DA TUPLA CON F.KEY (ANALIZZA DI CASO IN CASO)!

