DROP TABLE E1;
DROP TABLE R2;

CREATE TABLE E1(

	K1 INT NOT NULL PRIMARY KEY,
	A INT NOT NULL,
	TIPO2 SMALLINT NOT NULL CHECK(TIPO2 IN(0, 1)), --> I NOT NULL!!!
	TIPO3 SMALLINT NOT NULL CHECK(TIPO3 IN(0, 1)),
	
	B INT,
	K1R1 INT REFERENCES E1,
	
	C INT,
	
	--TOTALE NON ESCLUSIVA
	CONSTRAINT E2
		CHECK((TIPO2 = 1 AND B IS NOT NULL AND K1R1 IS NOT NULL) OR
			  (TIPO2 = 0 AND B IS NULL AND K1R1 IS NULL)),
			  
	CONSTRAINT E3
		CHECK((TIPO3 = 1 AND C IS NOT NULL) OR
			  (TIPO3 = 0 AND C IS NULL)),
			  
	CONSTRAINT TOTALE
		CHECK (TIPO2 <> 0 OR TIPO3 <> 0) --SE ENTRAMBI A 0 FALSO --> DEVE ESSERE ALMENO UNO DEI DUE A 1

		--O ANCHE CHECK(TIPO2 = 1 OR TIPO3 = 1)
);

CREATE TABLE R2 (

	K1E1 INT NOT NULL REFERENCES E1,
	K1E3 INT NOT NULL REFERENCES E1,
	
	PRIMARY KEY(K1E1,K1E3)

);

--NO
-- CREATE TABLE R2(

	-- K1E1 INT NOT NULL REFERENCES E1,
	-- K1E3 INT REFERENCES E1, --QUANDO INSERISCO UNA TUPLA IN R2 DEVO VERIFICARE CHE 
	
	-- PRIMARY KEY(K1E1)
	
-- );

--SE E1.TIPO3 = 0 ALLORA E1 NON PARTECIPA NELL' ASSOCIAZIONE R2 E QUINDI K1E3 = NULL
--E L'UNICA CHIAVE DI R2 E' K1E1
-- ALTRIMENTI SE E1.TIPO3 = 1 LA CHIAVE E' FORMATA DALL'UNIONE DI K1E1 E K1E3

--SE TIPO2=0  






