
DROP TABLE E1;
DROP TABLE E3;

CREATE TABLE E1(

	K1 INT NOT NULL PRIMARY KEY,
	A INT NOT NULL,
	B INT,
	
	TIPO23 SMALLINT NOT NULL CHECK(TIPO23 IN(2, 3)),
	C INT,
	
	CONSTRAINT E2
		CHECK((TIPO23 = 2 AND C IS NOT NULL) OR
			  (TIPO23 = 3 AND C IS NULL))
	
);

CREATE TABLE E3(

	D INT NOT NULL,
	K1 INT NOT NULL PRIMARY KEY REFERENCES E1, 
	--SE TIPO23 A CUI SI REFERENZIA LA TUPLA INSERITA TRAMITE K1
	--E' 2, ALLORA D E TT GLI ALTRI VAL DEVONO ESSERE NULLI,
	--ALTRIMENTI D DEVE ESSERE NON NULLO!(NULLA POSSO DIRE SUGLI ALTRI VAL)
	
	E INT,
	K1R INT REFERENCES E1,
	
	CONSTRAINT R_AND_PUNTOD
		CHECK((E IS NOT NULL AND K1R IS NOT NULL AND K1R <> K1) OR
			  (E IS NULL AND K1R IS NULL))
	
);