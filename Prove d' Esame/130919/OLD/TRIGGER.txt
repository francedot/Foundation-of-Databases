-->RESTRIZIONE A E4! TRIGGER!
--OGNI VOLTA CHE INSERISCO UNA TUPLA IN E1 DEVO ESSERE
--SICURO CHE IL VALORE DI CODR1 SIA PRESENTE IN E3

CREATE TRIGGER CODR1_REF_E4
NO CASCADE BEFORE INSERT ON E1
REFERENCING NEW AS N
FOR EACH ROW
WHEN(EXISTS(SELECT *
			FROM E3 
			WHERE N.CODR1 = E3.COD
			AND E3.TIPO34 = 4))
SIGNAL SQLSTATE '70001' ('La tupla inserita in E1 non referenzia una tupla di E4!');

-->RESTRIZIONE A E2! TRIGGER!

CREATE TRIGGER K1R2_REF_E2
NO CASCADE BEFORE INSERT ON E3
REFERENCING NEW AS N
FOR EACH ROW
WHEN(EXISTS(SELECT *
			FROM E1
			WHERE N.K1R2 = E1.K1
			AND E1.TIPO12 = 2))
SIGNAL SQLSTATE '70002' ('La tupla inserita in E1 non referenzia una tupla di E4!');

--UNIQUE(K3),

CREATE TRIGGER UNIQUE_K3
NO CASCADE BEFORE INSERT ON E3
REFERENCING NEW AS N
FOR EACH ROW
WHEN(EXISTS(SELECT *
			FROM E3
			WHERE N.K3 = E3.KR))
SIGNAL SQLSTATE '70003' ('La tupla inserita in E3 contiene un valore di K3 chiave!');

--UNIQUE(K1R2),

CREATE TRIGGER UNIQUE_K1R2
NO CASCADE BEFORE INSERT ON E3
REFERENCING NEW AS N
FOR EACH ROW
WHEN(EXISTS(SELECT *
			FROM E3
			WHERE N.K1R2 = E3.K1R2))
SIGNAL SQLSTATE '70004' ('La tupla inserita in E3 contiene un valore di K1R2 chiave!');





