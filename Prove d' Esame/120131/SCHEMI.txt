
DROP TABLE E1;
DROP TABLE E3;
DROP TABLE BE2;


CREATE TABLE E1(

	K1 INT NOT NULL PRIMARY KEY,
	A INT NOT NULL,
	
	TIPO2 SMALLINT NOT NULL CHECK(TIPO2 IN(0, 1)), --TIPO2 = 1 --> ISTANZA ANCHE DI E2
	
	CR2 INT,
	K1R1R2 INT,
	
	CONSTRAINT E2
		CHECK((TIPO2 = 0 AND CR2 IS NULL AND K1R1R2 IS NULL) OR
			  (TIPO2 = 1 AND CR2 IS NOT NULL AND K1R1R2 IS NOT NULL))
	
);

CREATE TABLE E3(

	C INT NOT NULL,
	K1R1 INT NOT NULL REFERENCES E1,
	
	PRIMARY KEY(C, K1R1)

);

CREATE TABLE BE2(

	B INT NOT NULL,
	K1B INT NOT NULL REFERENCES E1, --GARANTIRE CON TIPO = 2!
	
	PRIMARY KEY(B, K1B)
	
);

ALTER TABLE E1
ADD FOREIGN KEY(CR2, K1R1R2) REFERENCES E3;






