DROP TABLE R1;
DROP TABLE E1;
DROP TABLE E3;

CREATE TABLE E3(
	
	K3 INT NOT NULL PRIMARY KEY,
	C INT NOT NULL,
	TIPO SMALLINT NOT NULL CHECK (TIPO IN (3, 4)),
	D INT,
	
	CONSTRAINT E4
		CHECK((TIPO = 3 AND D IS NULL) OR
			  (TIPO = 4 AND D IS NOT NULL))
		
);

CREATE TABLE E1(

	K1 INT NOT NULL PRIMARY KEY,
	A INT NOT NULL, 
	TIPO SMALLINT NOT NULL CHECK (TIPO IN (1, 2)),
	B INT,
	K3R2 INT REFERENCES E3,
	
	CONSTRAINT E2
		CHECK((TIPO = 1 AND B IS NULL AND K3R2 IS NULL) OR
			  (TIPO = 2 AND B IS NOT NULL AND K3R2 IS NOT NULL))

);

CREATE TABLE R1(

	K1E1 INT NOT NULL REFERENCES E1,
	K3E3 INT NOT NULL REFERENCES E3,
	
	PRIMARY KEY(K1E1, K3E3)

);
