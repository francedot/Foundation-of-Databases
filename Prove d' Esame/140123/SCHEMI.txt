DROP TABLE E1;
DROP TABLE E2;
DROP TABLE R1;

CREATE TABLE E1(

	K1 INT NOT NULL PRIMARY KEY,
	A INT NOT NULL,
	TIPO SMALLINT NOT NULL CHECK(TIPO IN(1, 3)),
	D INT,
	E INT,
	
	CONSTRAINT E3 CHECK((TIPO = 3 AND D IS NOT NULL) OR 
					   (TIPO = 1 AND D IS NULL AND E IS NULL))

);

CREATE TABLE E2(

	K2 INT NOT NULL PRIMARY KEY,
	B INT,
	C INT NOT NULL,
	K1R2 INT REFERENCES E1
	
);

CREATE TABLE R1(

	K1 INT NOT NULL REFERENCES E1,
	K2 INT NOT NULL REFERENCES E2,
		F INT NOT NULL,
		
	PRIMARY KEY(K1, K2)
	
);

		
--TRIGGER PER FKEY K2 IN R1



-- CREATE TABLE E1(

	-- K1 INT NOT NULL,
	-- A INT NOT NULL,
	-- TIPO CHAR NOT NULL CHECK(TIPO IN('E1', 'E3')),
	-- D INT,
	-- E INT,
	
	-- CONSTRAINT E1_PKEY
		-- PRIMARY KEY(K1),
	-- CONSTRAINT COEX
		-- CHECK((TIPO = 'E3' AND D IS NOT NULL) OR 
			  -- (TIPO <> 'E3' AND D IS NULL AND E IS NULL))

-- );