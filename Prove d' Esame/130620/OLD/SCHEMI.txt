DROP TABLE E3;
DROP TABLE E1;

CREATE TABLE E3(

	K3 INT NOT NULL PRIMARY KEY,
	D INT NOT NULL

);

-- d) il valore di A è sempre almeno il doppio del valore
-- di B;

CREATE TABLE E1(

	K1 INT NOT NULL PRIMARY KEY,
	A INT NOT NULL,
	B INT NOT NULL,
	
	TIPO2 SMALLINT NOT NULL CHECK(TIPO2 IN(0, 1)), -- 1 ISTANZA ANCHE DI E2
	C INT,
	K3R2 INT REFERENCES E3,
	
	K3R1 INT REFERENCES E3,
	
	CONSTRAINT E2
		CHECK((TIPO2 = 0 AND C IS NULL AND K3R2 IS NULL) OR
			  (TIPO2 = 1 AND C IS NOT NULL AND K3R2 IS NOT NULL)),
	
	CONSTRAINT IF_E2_K3R2_NE_K3R1
		CHECK(/*TIPO2 = 1 AND */K3R2 <> K3R1), -- SE NON E' UN E2 --> K3R2 IS NULL
		
	CONSTRAINT A_GE_2B
		CHECK(A >= 2 * B)
	
);


