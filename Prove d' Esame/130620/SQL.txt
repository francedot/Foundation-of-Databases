
DROP TABLE CONFERENZE;
DROP TABLE ARTICOLI;
DROP TABLE AUTORI;

CREATE TABLE CONFERENZE (

	NOMECONF VARCHAR(15) NOT NULL,
	ANNO INT NOT NULL,
	LUOGO VARCHAR(15) NOT NULL,
	
	PRIMARY KEY(NOMECONF, ANNO)
	
);

CREATE TABLE ARTICOLI(

	ARTID CHAR(5) NOT NULL PRIMARY KEY,
	TITOLO VARCHAR(15) NOT NULL,
	NOMECONF VARCHAR(15) NOT NULL,
	ANNO INT NOT NULL,
	
	FOREIGN KEY(NOMECONF, ANNO)
		REFERENCES CONFERENZE
	
);

CREATE TABLE AUTORI(

	ARTID CHAR(5) NOT NULL,
	NOME VARCHAR(15) NOT NULL,
	
	PRIMARY KEY(ARTID, NOME)
	
);

--2.1) [2 p.] Gli autori che hanno pubblicato articoli sempre da soli

WITH ART_ONE_AUT(ARTID) AS(

	SELECT ARTID
	FROM AUTORI
	EXCEPT
	SELECT A1.ARTID
	FROM AUTORI A1, AUTORI A2
	WHERE A1.ARTID = A2.ARTID
	AND A1.NOME < A2.NOME
	
)

SELECT A.*
FROM ART_ONE_AUT AR JOIN AUTORI A ON (AR.ARTID = A.ARTID);

--sol. Prof

SELECT DISTINCT A.NOME
FROM AUTORI A
WHERE NOT EXISTS (SELECT *
				  FROM AUTORI A1
				  WHERE A1.ARTID = A.ARTID
				  AND A1.NOME <> A.NOME);

-- CONFERENZE(NomeConf,Anno,Luogo);

-- ARTICOLI(ArtID,Titolo,NomeConf,Anno),
-- NomeConf,Anno REFERENCES CONFERENZE;

-- AUTORI(ArtID,Nome),
-- ArtID REFERENCES ARTICOLI;

--2.2) [3 p.] Per ogni anno, l'autore che ha pubblicato nel maggior numero di conferenze distinte

WITH ANNO_AUT_NUMCONF(ANNO, NOME, NUMCONF) AS (

	SELECT AR.ANNO, AU.NOME, COUNT(DISTINCT AR.NOMECONF)
	FROM AUTORI AU, ARTICOLI AR
	WHERE AU.ARTID = AR.ARTID
	GROUP BY AR.ANNO, AU.NOME

)

SELECT A.ANNO, A.NOME
FROM ANNO_AUT_NUMCONF A
WHERE A.NUMCONF = (SELECT MAX(A1.NUMCONF)
				   FROM ANNO_AUT_NUMCONF A1
				   WHERE A1.ANNO = A.ANNO);

